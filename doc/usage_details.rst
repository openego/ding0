.. _ding0-examples:

How to use ding0?
~~~~~~~~~~~~~~~~~

Examples
========

We provide two examples of how to use Ding0 along with two example for analysis
of resulting data. The
:download:`first example <../ding0/examples/example_single_grid_district.py>` shows how Ding0
is applied to a single medium-voltage grid district. Grid topology for the
medium- and low-voltage grid level is generated an export to the *OEDB* and
save to file (.pkl).
The :download:`analysis script <../ding0/examples/example_analyze_single_grid_district.py>`
takes data generated the first example and produces exemplary output: key
figures and plots.

The second example shows how to generate a larger number of grid topology data
sets.
As the current data source sometimes produces unuseful data or leads to program
execution interruption, these are excluded from grid topology generation. This
is enable by setting :code:`failsafe=` to `True`.
The according analysis script provides exemplary plots for data of multiple grid
districts.


High-level functions
====================

Run ding0
---------

Check out :meth:`~core.Network.run_ding0()` as high-level function which is also used the
:download:`example <../ding0/examples/example_single_grid_district.py>`.

For larger calculation (parallelization)
----------------------------------------

To generate data for a larger area consider to parallelize  execution of Ding0
using :func:`~.examples.example_multiple_grid_districts.run_multiple_grid_districts`.


Analysis of grid data
=====================

Export key figures
------------------

We provide a set of functions to export key figures of the generated data.
The following assumes a Ding0 network is available generated like

.. code-block:: python

    from egoio.tools import db
    from ding0.core import NetworkDing0

    conn = db.connection(section='oedb')

    network = NetworkDing0(name='network')
    network.run_ding0(
        conn=conn,
        mv_grid_districts_no=[3040])



Extract key information about medium and low voltage grid topology.

.. code-block:: python

    from ding0.tools.results import calculate_mvgd_stats

    # statistical key figures of medium voltage grid
    mv_stats = calculate_mvgd_stats(network)

    # statistical key figures of medium voltage grid
    lv_stats = calculate_lvgd_stats(network)

Information about power flows and voltage levels from final approving power flow
analysis can be obtained from
:func:`~.tools.results.calculate_mvgd_voltage_current_stats` and
:func:`~.tools.results.calculate_lvgd_voltage_current_stats`.

If a large number of grid districts is involved consider to parallelize the
execution by

.. code-block:: python

    mv_stats,
     lvgd_stat
     mv_nodes,
     mv_edges,
     lv_nodes,
     lv_edges = parallel_running_stats(
        districts_list = mv_grid_districts,
        n_of_processes = n_of_processes,
        n_of_districts = n_of_districts,
        source = 'pkl',
        mode = '')

Data is read from file and returned in six tables.

Furthermore, the function :func:`~.core.Network.to_dataframe()` allows to get
tabular information about nodes and edges of the grid topology representing
graph.

.. code-block:: python

    nodes, edges = network.to_dataframe()


Compare data versions
---------------------

Data generated by different versions of Ding0 or different input data can be
easily compared. Load datasets designated for comparison and pass to
:func:`~.tools.results.dataframe_equal`.

.. code-block:: python

    network_a = load_nd_from_pickle(filename='filename_a.pkl')
    network_b = load_nd_from_pickle(filename='filename_b.pkl')

    passed, msg = dataframe_equal(network_a, network_b)


Explanation of key figures
--------------------------

========= ======================================= ====
Parameter Description                             Unit
========= ======================================= ====
km_cable  Cumulative length of underground cables km
========= ======================================= ====


CSV file export
===============

Ding0 objects are exported in csv files.

Lines
-----
.. csv-table:: line.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of corresponding grid (MVgrid-id if MV-edge, LVgrid-id if LV-edge", "n/a"
   "edge_name", "str", "unambiguous name of edge", "n/a"
   "grid_name", "str", "unambiguous name of grid", "n/a"
   "node1","str","id_db of first node","n/a"
   "node2","str","id_db of second node","n/a"
   "type_kind","str","","n/a"
   "type_name","str","","n/a"
   "length","float","length of line","km"
   "u_n","float","nominal voltage","kV"
   "c","float","inductive resistance at 50Hz","uF/km"
   "l","float","","mH/km"
   "r","float","","Ohm/km"
   "i_max_th","float","","A"
   "geom", "None","geometric coordinates", "n/a"


LV-Branchtees
-----------
.. csv-table:: lv_branchtee.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of LV-Grid", "n/a"
   "geom", "None","geometric coordinates", "WGS 84, POINT"
   "name", "str", "unambiguous name: 'LVCableDistributorDing0_LV_#lvgridid#_#ascendingnumber#'", "n/a"


LV-Generators
-----------
.. csv-table:: lv_generator.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of LV-Grid", "n/a"
   "la_id", "int", "", ""
   "name", "str", "unambiguous name: 'LVGeneratorDing0_LV_#lvgridid#_#ascendingnumber#'", "n/a"
   "lv_grid_id", "int","unambiguous id_db of LV-Grid", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, POINT"
   "type","str","type of generation","{solar; biomass}"
   "subtype","str","subtype of generation: {solar_roof_mounted, unknown; biomass}","n/a"
   "v_level","int","voltage level of generator",""
   "nominal_capacity","float","nominal capacity",""
   "is_aggregated", "boolean", "True if load is aggregated load, else False", "n/a"
   "weather_cell_id", "int", "unambiguous number of the corresponding weather cell", "n/a"

LV-Grids
-----------
.. csv-table:: lv_grid.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int", "unambiguous number of LV-Grid", "n/a"
   "name", "str", "unambiguous name: 'LVGridDing0_LV_#lvgridid#_#lvgridid#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, MULTIPOLYGON"
   "population","int","population in LV-Grid","?"
   "voltage_nom","float","voltage level of grid","kV"

LV-Loads
-----------
.. csv-table:: lv_load.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int", "unambiguous number of LV-Grid", "n/a"
   "name", "str", "unambiguous name: 'LVLoadDing0_LV_#lvgridid#_#ascendingnumber#'", "n/a"
   "lv_grid_id", "int","unambiguous id_db of LV-Grid", "n/a"
   "geom", "None", "geometric coordinates", "WGS84, POINT"
   "consumption","{''str'': float}","type of load {residential, agricultural, industrial} and corresponding consumption", "n/a"


LV-Stations
-----------
.. csv-table:: lvmv_station.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int", "unambiguous number of LV-Grid", "n/a"
   "geom", "wkt", "geometric coordinates", "WGS84, POINT"
   "name", "str", "unambiguous name: 'LVStationDing0_MV_#mvgridid#_#lvgridid#'", "n/a"


LV-Transformers
-----------
.. csv-table:: lv_transformer.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of LV-Grid", "n/a"
   "name", "str", "unambiguous name: 'TransformerDing0_LV_#mvgridid#_#lvgridid#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84 POINT"
   "voltage_op","float","","kV"
   "s_nom","float","nominal apparent power","kVA"
   "x","float","","Ohm"
   "r","float","","Ohm"


LV-Grids
-----------
.. csv-table:: mvlv_mapping.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "lv_grid_id", "int","unambiguous number of LV-Grid", "n/a"
   "lv_grid_name", "str", "unambiguous name: 'LVGridDing0_LV_#lvgridid#_#lvgridid#'", "n/a"
   "mv_grid_id", "int","unambiguous number of MV-Grid", "n/a"
   "mv_grid_name", "str", "unambiguous name: 'MVGridDing0_MV_#mvgridid#_#mvgridid#'", "n/a"


MV-Branchtees
-----------
.. csv-table:: mv_branchtee.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous id_db of MV-Grid", "n/a"
   "name", "str", "unambiguous name: 'MVCableDistributorDing0_MV_#mvgridid#_#ascendingnumber#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, POINT"

MV-Generators
-----------
.. csv-table:: mv_generator.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int", "unambiguous number of MV-Grid", "n/a"
   "name", "str", "unambiguous name: 'MVGeneratorDing0_MV_#mvgridid#_#ascendingnumber#'", "n/a"
   "geom", "wkt", "geometric coordinates", "WGS84, POINT"
   "type", "str", "type of generation: {solar; biomass}", "n/a"
   "subtype", "str", "subtype of generation: {solar_ground_mounted, solar_roof_mounted, unknown; biomass, biogas}", "n/a"
   "v_level", "int", "voltage level of generator", ""
   "nominal_capacity", "float", "nominal capacity", ""
   "is_aggregated", "boolean", "True if load is aggregated load, else False", "n/a"
   "weather_cell_id", "int", "unambiguous number of the corresponding weather cell", "n/a"


MV-Grids
-----------
.. csv-table:: mv_grid.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of LV-Grid", "n/a"
   "name", "str", "unambiguous name: 'MVGridDing0_MV_#mvgridid#_#mvgridid#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, MULTIPOLYGON"
   "population","int","population in LV-Grid","?"
   "voltage_nom","float","voltage level of grid","kV"


MV-Loads
-----------
.. csv-table:: mv_load.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of MV-Grid", "n/a"
   "name", "str", "unambiguous name: 'MVLoadDing0_MV_#mvgridid#_#ascendingnumber#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, POLYGON"
   "consumption","{''str'': float}","type of load {retail, residential, agricultural, industrial} and corresponding consumption","n/a"
   "is_aggregated", "boolean", "True if load is aggregated load, else False", "n/a"


MV-Stations
-----------
.. csv-table:: mvhv_station.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of MV-Grid", "n/a"
   "name", "str", "unambiguous name: 'MVStationDing0_MV_#mvgridid#_#mvgridid#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, POINT"


MV-Transformers
-----------
.. csv-table:: lv_transformer.csv
   :header: "Field","type", "Description", "Unit"
   :widths: 15, 10, 10, 30

   "run_id", "int", "time and date of table generation", "yyyyMMddhhmmss"
   "id_db", "int","unambiguous number of LV-Grid", "n/a"
   "name", "str", "unambiguous name: 'TransformerDing0_MV_#mvgridid#_#mvgridid#'", "n/a"
   "geom", "wkt","geometric coordinates", "WGS84, POINT"
   "voltage_op","float","","kV"
   "s_nom","float","nominal apparent power","kVA"
   "x","float","","Ohm"
   "r","float","","Ohm"
